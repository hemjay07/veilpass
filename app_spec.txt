<project_specification>

<project_name>VeilPass</project_name>

<overview>
VeilPass is a privacy-preserving compliance attestation platform for tokenizing real-world assets (RWA) on Solana. It enables users to prove compliance (KYC, AML, accredited investor status) without revealing their personal information through cryptographic attestations and selective disclosure. Users can generate compliance proofs, create time-limited disclosure links for auditors, and verify compliance cryptographically - all while maintaining data privacy.

Target: Solana Privacy Hack 2026 ($30,500 potential prizes across Open Track, Privacy Cash, Range, and Helius bounties)
Tagline: "Privacy that passes compliance"
</overview>

<technology_stack>
  <frontend>
    <framework>Next.js 14 with App Router</framework>
    <language>TypeScript 5.x</language>
    <styling>Tailwind CSS 3.4.x with tailwindcss-animate</styling>
    <components>shadcn/ui (button, card, input, label, select, checkbox, toast, dialog)</components>
    <wallet>@solana/wallet-adapter-react, @solana/wallet-adapter-react-ui, @solana/wallet-adapter-wallets</wallet>
    <port>3000</port>
  </frontend>
  <backend>
    <runtime>Next.js API Routes (serverless)</runtime>
    <blockchain>@solana/web3.js 1.87.x</blockchain>
    <storage>Vercel KV (production) / Local memory mock (development)</storage>
    <validation>Zod schemas</validation>
    <rpc>Helius devnet RPC</rpc>
  </backend>
  <communication>
    <api>Next.js API routes at /api/*</api>
    <wallet>Solana wallet-adapter for wallet connection and message signing</wallet>
  </communication>
</technology_stack>

<feature_count>85</feature_count>

<prerequisites>
  <environment_setup>
    - Node.js 18+ installed
    - npm package manager
    - Phantom browser extension for Solana wallet
    - Helius API key (from helius.dev)
    - Devnet SOL in wallet (from faucet.solana.com)
  </environment_setup>
</prerequisites>

<database_schema>
  <storage_layer>
    Note: This project uses Vercel KV (Redis-compatible) for storage, not SQLite.
    Data is stored as JSON with TTL-based expiration.
    For local development, an in-memory mock (kv-local.ts) is used.
  </storage_layer>

  <models>
    <RWATokenMetadata>
      - name: string (token name)
      - symbol: string (token symbol, uppercase)
      - totalSupply: number
      - decimals: number
      - compliance: object
        - level: 'NONE' | 'KYC' | 'ACCREDITED' | 'INSTITUTIONAL'
        - allowedJurisdictions: string[]
        - restrictedJurisdictions: string[]
        - minimumInvestment?: number
      - assetType: 'REAL_ESTATE' | 'EQUITY' | 'DEBT' | 'COMMODITY' | 'OTHER'
      - assetDescription: string
    </RWATokenMetadata>

    <RWAToken>
      - address: string (Solana public key)
      - issuer: string (wallet address)
      - metadata: RWATokenMetadata
      - encryptedMetadata: string
      - metadataHash: string
      - createdAt: number (timestamp)
    </RWAToken>

    <Attestation>
      Key: attestation:{id}
      - id: string (16-char hex)
      - holder: string (wallet address, 32-44 chars)
      - tokenAddress?: string (optional token association)
      - claims: ClaimType[] (array of claim types)
      - commitment: string (cryptographic commitment hash)
      - claimsHash: string (hash of claims + salt)
      - createdAt: number (timestamp)
      - expiresAt: number (timestamp, default 1 year)
      - isValid: boolean
      TTL: Based on expiresAt
    </Attestation>

    <AttestationSecret>
      (Stored client-side only, never sent to server after generation)
      - attestationId: string
      - salt: string (64-char hex)
      - fullClaims: AttestationClaim[]
    </AttestationSecret>

    <AttestationClaim>
      - type: ClaimType
      - value: boolean | string
      - provider: string (e.g., 'VeilPass-Mock')
      - issuedAt: number
      - expiresAt: number
    </AttestationClaim>

    <Disclosure>
      Key: disclosure:{id}
      - id: string (12-char hex)
      - attestationId: string
      - discloser: string (wallet address)
      - recipient?: string (optional auditor address)
      - disclosedFields: ClaimType[]
      - disclosedData: Record of string to any
      - proofHash: string
      - createdAt: number
      - expiresAt: number (default 7 days)
      - accessCount: number (starts at 0)
      - maxAccesses: number (default 10)
      TTL: Based on expiresAt
    </Disclosure>

    <ClaimType enum>
      - 'KYC_VERIFIED'
      - 'AML_PASSED'
      - 'ACCREDITED_INVESTOR'
      - 'JURISDICTION_COMPLIANT'
      - 'SOURCE_OF_FUNDS_VERIFIED'
    </ClaimType>
  </models>

  <indexes>
    - holder:{walletAddress}:attestations -> string[] (attestation IDs for a wallet)
  </indexes>
</database_schema>

<api_endpoints_summary>
  <attestations>
    - POST /api/attestations/generate
      Input: { holder: string, claims: ClaimType[], tokenAddress?: string, signature: string }
      Output: { success: boolean, data: { attestation: Attestation, secret: AttestationSecret } }
      Validation: Zod GenerateAttestationSchema, isValidPublicKey check

    - POST /api/attestations/verify
      Input: { attestationId: string, salt: string, claims: AttestationClaim[] }
      Output: { success: boolean, data: { isValid: boolean, attestation?: Attestation } }
  </attestations>

  <disclosures>
    - POST /api/disclosures/create
      Input: { attestationId: string, salt: string, fullClaims: AttestationClaim[], fieldsToDisclose: ClaimType[], recipient?: string, expiresInDays?: number, maxAccesses?: number, signature: string }
      Output: { success: boolean, data: { disclosureId: string, verifyUrl: string, expiresAt: number } }
      Validation: Zod CreateDisclosureSchema, attestation verification

    - GET /api/disclosures/[id]
      Output: { success: boolean, data: VerificationResult } or error
      Side effect: Increments accessCount
  </disclosures>
</api_endpoints_summary>

<ui_layout>
  <main_structure>
    - Sticky header with navigation and wallet button
    - Main content area (flex-1)
    - Footer with hackathon branding
    - Dark mode only (class="dark" on html element)
  </main_structure>

  <header>
    - Logo "V" in blue square + "VeilPass" text (links to /)
    - Navigation: Mint, Attest, Disclose, Dashboard (hidden on mobile)
    - WalletButton component on right
    - Border-bottom, backdrop-blur, sticky top-0 z-50
  </header>

  <pages>
    - / (Landing): Hero section with tagline, CTA buttons, feature cards, how-it-works steps
    - /mint: Token creation form (demo mode)
    - /attest: ClaimSelector + AttestationForm, success state with secret download
    - /disclose: Secret file upload + FieldSelector + DisclosureForm, success state with shareable link
    - /verify/[id]: Disclosure verification display with verified badge
    - /dashboard: Quick actions grid, wallet info, how-it-works explanation
  </pages>

  <components>
    - Container: Centered content wrapper with padding
    - Card: bg-zinc-900 border-zinc-800 for all content boxes
    - Button: Primary (bg-primary), Outline (border), Ghost (transparent)
    - Input: bg-zinc-800 border-zinc-700
    - Checkbox: For claim/field selection
    - Loading states: "Generating...", "Creating...", spinner animations
  </components>

  <modals_overlays>
    - Wallet connect modal (from wallet-adapter-react-ui)
    - Toast notifications for success/error feedback
  </modals_overlays>
</ui_layout>

<design_system>
  <overview>
    Dark mode only, privacy-focused professional aesthetic. Clean, confident, and trustworthy design emphasizing security and compliance. Minimal animations, clear hierarchy, generous spacing.
  </overview>

  <color_palette>
    <theme_default>dark</theme_default>
    <theme_support>dark_only</theme_support>

    <colors>
      - Primary: #1E3A8A (Deep Blue - trust, security, primary actions) -> bg-blue-900, bg-primary
      - Accent: #10B981 (Emerald - success, verified, positive states) -> bg-emerald-500, text-accent
      - Background: #0A0A0B (Near Black - page background) -> bg-zinc-950, bg-background
      - Surface: #18181B (Dark Gray - cards, elevated surfaces) -> bg-zinc-900
      - Border: #27272A (Gray - borders, dividers) -> border-zinc-800
      - Input Background: #27272A -> bg-zinc-800
      - Input Border: #3F3F46 -> border-zinc-700
      - Text Primary: #FAFAFA (White - headings, important text) -> text-zinc-50
      - Text Secondary: #A1A1AA (Gray - body text, descriptions) -> text-zinc-400
      - Text Muted: #71717A (Darker gray - labels, captions) -> text-zinc-500
      - Warning: #F59E0B (Amber - important notices) -> text-amber-500, bg-amber-500/10
      - Error: #EF4444 (Red - errors, destructive) -> text-red-500
    </colors>
  </color_palette>

  <typography>
    <fonts>
      - Primary: Inter (Google Fonts) - clean, modern, professional
      - Code/Mono: System monospace for addresses, IDs, hashes
    </fonts>
    <hierarchy>
      - Page title: text-3xl font-bold (30px)
      - Section title: text-2xl font-bold (24px)
      - Card title: text-xl font-semibold (20px) via CardTitle
      - Body: text-base (16px) text-zinc-400
      - Small/Caption: text-sm (14px) text-zinc-500
      - Tiny: text-xs (12px) for badges, timestamps
    </hierarchy>
  </typography>

  <components>
    <buttons>
      - Primary: bg-primary hover:bg-primary/90 text-white rounded-lg px-4 py-2
      - Outline: border border-zinc-700 hover:bg-zinc-800 rounded-lg
      - Ghost: hover:bg-zinc-800 rounded-lg
      - Size lg: text-lg px-6 py-3
      - Size sm: text-sm px-3 py-1.5
      - Disabled: opacity-50 cursor-not-allowed
      - Full width: w-full
    </buttons>

    <cards>
      - Base: bg-zinc-900 border border-zinc-800 rounded-lg
      - Warning: bg-amber-500/10 border-amber-500/20
      - Error: bg-red-500/10 border-red-500/20
      - Success implicit via accent color usage
      - Padding: p-6 via CardContent
    </cards>

    <inputs>
      - Base: bg-zinc-800 border-zinc-700 rounded-md px-3 py-2 text-white
      - Focus: ring-2 ring-primary outline-none
      - Placeholder: text-zinc-500
      - File input: styled via Input component
    </inputs>

    <badges>
      - Claim badges: px-2 py-1 bg-accent/20 text-accent rounded text-sm
      - Status badge: inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm
    </badges>

    <selection_items>
      - Checkbox rows: p-3 rounded-lg border border-zinc-800 hover:border-zinc-700 transition cursor-pointer
      - Selected state: Show "Will be disclosed" text in accent color
    </selection_items>
  </components>

  <spacing>
    - Page padding: py-16 (landing), py-8 (other pages)
    - Container max-width: max-w-2xl for forms, max-w-4xl for dashboard, max-w-3xl for landing hero
    - Section gaps: mb-16 (landing sections), mb-8 (page sections)
    - Component gaps: space-y-6 (form fields), space-y-4 (list items)
    - Grid gaps: gap-6 (card grids), gap-4 (button groups)
  </spacing>

  <animations>
    - Transitions: transition (200ms default for hover states)
    - Loading: animate-pulse for skeleton states
    - No complex animations - professional, minimal aesthetic
  </animations>

  <unique_elements>
    - Shield logo: w-8 h-8 bg-primary rounded-lg with "V" letter
    - Verified badge: Green dot + "Cryptographically Verified" text
    - Secret file warning: Amber card with warning icon
    - Claim/field selectors: Interactive checkbox rows with descriptions
  </unique_elements>
</design_system>

<key_interactions>
  <attestation_flow>
    1. User connects Phantom wallet
    2. User navigates to /attest
    3. User selects one or more claims (KYC, AML, etc.)
    4. User clicks "Generate Attestation"
    5. Wallet prompts for message signature
    6. API generates attestation and secret
    7. Success card shows attestation ID and claims
    8. User downloads secret JSON file (CRITICAL - cannot be recovered)
    9. User can create another or proceed to disclosure
  </attestation_flow>

  <disclosure_flow>
    1. User navigates to /disclose
    2. User uploads their secret JSON file
    3. Secret file parsed, available fields shown
    4. User selects which fields to disclose (selective!)
    5. User optionally sets recipient, expiry, max accesses
    6. User clicks "Create Disclosure Link"
    7. Wallet prompts for message signature
    8. API verifies attestation, creates disclosure
    9. Success card shows shareable link
    10. User copies link to share with auditor
  </disclosure_flow>

  <verification_flow>
    1. Auditor receives disclosure link (/verify/[id])
    2. Page loads, fetches disclosure from API
    3. Access count incremented
    4. If valid: Shows green verified badge + disclosed data only
    5. If expired/invalid: Shows red error card with reason
    6. Auditor sees only the fields the user chose to disclose
  </verification_flow>
</key_interactions>

<implementation_steps>
  <step number="1">
    <title>Project Setup and Dependencies</title>
    <tasks>
      - Initialize Next.js 14 with TypeScript, Tailwind, ESLint, App Router, src directory
      - Install core dependencies: @solana/web3.js, wallet-adapter packages, @vercel/kv, zod
      - Install tailwindcss-animate for component animations
      - Initialize shadcn/ui with Zinc base color and CSS variables
      - Add shadcn components: button, card, input, label, select, checkbox, toast, dialog
      - Create .env.example and .env.local with all required variables
      - Generate encryption secret with openssl rand -hex 32
    </tasks>
  </step>

  <step number="2">
    <title>Type Definitions and Core Libraries</title>
    <tasks>
      - Create src/types/index.ts with all TypeScript interfaces
      - Create src/lib/crypto.ts (client-safe: truncateAddress, uint8ArrayToBase64)
      - Create src/lib/crypto.server.ts (server-only: generateSalt, generateId, hashData, encrypt, decrypt)
      - Create src/lib/solana.ts (connection, isValidPublicKey, getExplorerUrl)
      - Create src/lib/kv-local.ts (local development mock for Vercel KV)
      - Create src/lib/kv.ts (storage abstraction with KV/local fallback)
      - Create src/lib/validation.ts (Zod schemas for all API inputs)
    </tasks>
  </step>

  <step number="3">
    <title>Business Logic Libraries</title>
    <tasks>
      - Create src/lib/attestation.ts (generateAttestation, verifyAttestation)
      - Create src/lib/disclosure.ts (createDisclosure, verifyDisclosure, formatDisclosureUrl)
      - Implement cryptographic commitment scheme (holder + claimsHash + salt)
      - Implement selective disclosure data extraction
    </tasks>
  </step>

  <step number="4">
    <title>UI Foundation</title>
    <tasks>
      - Configure tailwind.config.ts with dark mode, custom colors, tailwindcss-animate
      - Update src/app/globals.css with CSS variables for dark theme
      - Create src/components/wallet/WalletProvider.tsx
      - Create src/components/wallet/WalletButton.tsx
      - Create src/components/layout/Header.tsx with navigation
      - Create src/components/layout/Footer.tsx with hackathon branding
      - Create src/components/layout/Container.tsx
      - Update src/app/layout.tsx with providers and layout structure
    </tasks>
  </step>

  <step number="5">
    <title>Landing and Dashboard Pages</title>
    <tasks>
      - Create src/app/page.tsx (landing page with hero, features, how-it-works)
      - Create src/app/dashboard/page.tsx (quick actions, wallet info)
      - Create src/app/mint/page.tsx (demo token creation form)
    </tasks>
  </step>

  <step number="6">
    <title>Attestation Feature</title>
    <tasks>
      - Create src/components/attestation/ClaimSelector.tsx
      - Create src/components/attestation/AttestationForm.tsx
      - Create src/app/attest/page.tsx with form and success states
      - Create src/app/api/attestations/generate/route.ts
      - Create src/app/api/attestations/verify/route.ts
      - Implement secret file download functionality
    </tasks>
  </step>

  <step number="7">
    <title>Disclosure Feature</title>
    <tasks>
      - Create src/components/disclosure/FieldSelector.tsx
      - Create src/components/disclosure/DisclosureForm.tsx
      - Create src/app/disclose/page.tsx with file upload and success states
      - Create src/app/api/disclosures/create/route.ts
      - Create src/app/api/disclosures/[id]/route.ts
      - Implement copy-to-clipboard for disclosure link
    </tasks>
  </step>

  <step number="8">
    <title>Verification Page</title>
    <tasks>
      - Create src/app/verify/[id]/page.tsx
      - Handle loading, success, and error states
      - Display verified badge and disclosed data
      - Show access count and expiration info
    </tasks>
  </step>

  <step number="9">
    <title>Testing and Polish</title>
    <tasks>
      - Test complete attestation flow end-to-end
      - Test complete disclosure flow end-to-end
      - Test verification with valid and invalid IDs
      - Verify mobile responsiveness
      - Check accessibility (keyboard navigation, labels)
      - Run TypeScript check (npx tsc --noEmit)
      - Run production build (npm run build)
    </tasks>
  </step>
</implementation_steps>

<success_criteria>
  <functionality>
    - Wallet connects and disconnects properly
    - Attestation generates with unique ID and downloadable secret
    - Disclosure creates shareable link with selective fields
    - Verification page shows only disclosed fields
    - Access limits and expiration enforced
    - All API endpoints return proper success/error responses
    - Local KV mock works for development without Vercel
  </functionality>

  <user_experience>
    - Clear feedback at every step (loading, success, error states)
    - Secret file download is prominent with warning
    - Copy-to-clipboard provides confirmation
    - Forms validate before submission
    - Navigation is intuitive
    - Mobile layout works correctly
  </user_experience>

  <technical_quality>
    - TypeScript compiles without errors
    - Production build succeeds
    - No console errors in browser
    - Server/client code properly separated (crypto modules)
    - API routes validate all inputs with Zod
    - Wallet addresses validated before use
  </technical_quality>

  <design_polish>
    - Consistent dark theme throughout
    - Colors match design system exactly
    - Proper spacing and typography hierarchy
    - Cards and buttons styled consistently
    - Professional, trustworthy appearance
  </design_polish>

  <hackathon_requirements>
    - Uses Solana wallet integration (wallet-adapter)
    - Uses Helius RPC endpoint
    - Demonstrates privacy-preserving compliance
    - Implements selective disclosure
    - Has compelling landing page explaining value
  </hackathon_requirements>
</success_criteria>

<core_features>
  <!-- A. Security and Access Control (8 features) -->
  <security_access_control>
    <feature id="1">
      <name>Wallet connection required for attestation generation</name>
      <description>Verify that the attestation form shows "Connect your wallet" message when no wallet is connected, and the Generate button is only active when wallet is connected</description>
      <steps>
        - Navigate to /attest
        - Verify "Connect your wallet to generate an attestation" message appears
        - Connect Phantom wallet
        - Verify claim selector and form become visible
        - Verify Generate Attestation button is enabled
      </steps>
    </feature>

    <feature id="2">
      <name>Wallet connection required for disclosure creation</name>
      <description>Verify that the disclosure form shows connect prompt when no wallet connected</description>
      <steps>
        - Navigate to /disclose
        - Verify "Connect your wallet to create a disclosure" message appears
        - Connect wallet
        - Verify file upload and form become visible
      </steps>
    </feature>

    <feature id="3">
      <name>Signature verification on attestation requests</name>
      <description>Verify that attestation generation requires wallet signature and includes signature in API request</description>
      <steps>
        - Connect wallet and select claims on /attest
        - Click Generate Attestation
        - Verify Phantom signature popup appears
        - Sign the message
        - Verify API receives signature in request body
      </steps>
    </feature>

    <feature id="4">
      <name>Signature verification on disclosure requests</name>
      <description>Verify disclosure creation requires wallet signature</description>
      <steps>
        - Upload valid secret file on /disclose
        - Select fields to disclose
        - Click Create Disclosure Link
        - Verify signature popup appears
        - Sign and verify API receives signature
      </steps>
    </feature>

    <feature id="5">
      <name>Invalid wallet address rejected by API</name>
      <description>Verify attestation API rejects invalid Solana public key format</description>
      <steps>
        - Send POST to /api/attestations/generate with holder: "invalid-address"
        - Verify 400 response with "Invalid wallet address" error
        - Send with holder: "abc" (too short)
        - Verify rejection
      </steps>
    </feature>

    <feature id="6">
      <name>Expired attestations return proper error</name>
      <description>Verify verification fails for expired attestations</description>
      <steps>
        - Create attestation with artificially expired expiresAt in test
        - Attempt to verify
        - Verify isValid: false response
      </steps>
    </feature>

    <feature id="7">
      <name>Access limit enforced on disclosures</name>
      <description>Verify disclosure becomes inaccessible after maxAccesses reached</description>
      <steps>
        - Create disclosure with maxAccesses: 2
        - Access /verify/[id] first time - success
        - Access second time - success
        - Access third time - error "Maximum access limit (2) reached"
      </steps>
    </feature>

    <feature id="8">
      <name>Encryption secret properly configured</name>
      <description>Verify ENCRYPTION_SECRET is set and crypto functions work</description>
      <steps>
        - Check .env.local has ENCRYPTION_SECRET (64-char hex)
        - Verify attestation generation succeeds (uses crypto internally)
        - Verify no crypto errors in server logs
      </steps>
    </feature>
  </security_access_control>

  <!-- B. Navigation Integrity (6 features) -->
  <navigation_integrity>
    <feature id="9">
      <name>Header navigation links work correctly</name>
      <description>Verify all header nav links navigate to correct pages</description>
      <steps>
        - Click "Mint" in header - verify /mint page loads
        - Click "Attest" - verify /attest page loads
        - Click "Disclose" - verify /disclose page loads
        - Click "Dashboard" - verify /dashboard page loads
      </steps>
    </feature>

    <feature id="10">
      <name>Logo links to home page</name>
      <description>Verify clicking logo/brand returns to landing page</description>
      <steps>
        - Navigate to /attest
        - Click VeilPass logo in header
        - Verify redirected to / (landing page)
      </steps>
    </feature>

    <feature id="11">
      <name>All page routes render without errors</name>
      <description>Verify every page route renders successfully</description>
      <steps>
        - Navigate to / - verify renders
        - Navigate to /mint - verify renders
        - Navigate to /attest - verify renders
        - Navigate to /disclose - verify renders
        - Navigate to /dashboard - verify renders
        - Navigate to /verify/test-id - verify renders (may show error state, but no crash)
      </steps>
    </feature>

    <feature id="12">
      <name>Invalid routes show 404</name>
      <description>Verify non-existent routes show proper 404 page</description>
      <steps>
        - Navigate to /nonexistent-page
        - Verify 404 page or Next.js default error
        - No crash or blank page
      </steps>
    </feature>

    <feature id="13">
      <name>Verify page handles invalid disclosure IDs</name>
      <description>Verify /verify/[id] shows error for non-existent disclosure</description>
      <steps>
        - Navigate to /verify/invalid123
        - Verify error card displays "Disclosure not found or has been deleted"
        - Verify red styling for error state
      </steps>
    </feature>

    <feature id="14">
      <name>Dashboard shows connect wallet prompt when disconnected</name>
      <description>Verify dashboard prompts connection when no wallet</description>
      <steps>
        - Disconnect wallet
        - Navigate to /dashboard
        - Verify "Connect Your Wallet" card with explanation text
      </steps>
    </feature>
  </navigation_integrity>

  <!-- C. Real Data Verification (8 features) -->
  <real_data_verification>
    <feature id="15">
      <name>Generated attestation stored in KV storage</name>
      <description>Verify attestation is persisted and retrievable</description>
      <steps>
        - Generate attestation via /attest
        - Note the attestation ID
        - Verify attestation exists in KV (via server logs or direct check)
        - Verify attestation:ID key contains valid data
      </steps>
    </feature>

    <feature id="16">
      <name>Attestation retrievable by ID</name>
      <description>Verify getAttestation function returns stored data</description>
      <steps>
        - Generate attestation, note ID
        - Use getAttestation(id) in API route
        - Verify returns correct holder, claims, timestamps
      </steps>
    </feature>

    <feature id="17">
      <name>Disclosure stored with correct fields</name>
      <description>Verify disclosure contains all expected data</description>
      <steps>
        - Create disclosure with specific fields selected
        - Check stored disclosure object
        - Verify disclosedFields matches selection
        - Verify disclosedData contains only selected fields
        - Verify proofHash is set
      </steps>
    </feature>

    <feature id="18">
      <name>Disclosure access count increments</name>
      <description>Verify accessCount increases on each verification</description>
      <steps>
        - Create disclosure
        - Verify /verify/[id] - check accessNumber in response
        - Verify again - accessNumber should be 2
        - Check stored disclosure.accessCount is 2
      </steps>
    </feature>

    <feature id="19">
      <name>Attestation claims hash verifiable</name>
      <description>Verify claimsHash matches when recalculated with salt</description>
      <steps>
        - Generate attestation, save secret file
        - Extract salt and fullClaims from secret
        - Recalculate hash with createClaimsHash(fullClaims, salt)
        - Verify matches attestation.claimsHash
      </steps>
    </feature>

    <feature id="20">
      <name>Disclosure proof hash validates</name>
      <description>Verify proofHash is deterministically generated</description>
      <steps>
        - Create disclosure
        - Check proofHash is 64-char hex string
        - Verify it's based on commitment + disclosedData + id
      </steps>
    </feature>

    <feature id="21">
      <name>Secret file contains correct attestation ID</name>
      <description>Verify downloaded secret file has matching attestationId</description>
      <steps>
        - Generate attestation, download secret
        - Parse JSON, extract attestationId
        - Verify matches displayed attestation ID
        - Verify salt is 64-char hex
        - Verify fullClaims array has correct claim types
      </steps>
    </feature>

    <feature id="22">
      <name>Verify page displays actual disclosed data</name>
      <description>Verify verification shows real data, not mock/placeholder</description>
      <steps>
        - Create attestation with KYC_VERIFIED and AML_PASSED
        - Create disclosure with only KYC_VERIFIED
        - Visit verify page
        - Verify only KYC_VERIFIED shown
        - Verify shows provider, issuedAt date
        - Verify AML_PASSED is NOT visible
      </steps>
    </feature>
  </real_data_verification>

  <!-- D. Workflow Completeness (10 features) -->
  <workflow_completeness>
    <feature id="23">
      <name>Complete attestation generation flow</name>
      <description>Test end-to-end attestation creation from start to finish</description>
      <steps>
        - Connect wallet
        - Navigate to /attest
        - Select KYC_VERIFIED, AML_PASSED, ACCREDITED_INVESTOR
        - Click Generate Attestation
        - Sign message in wallet
        - Verify success card appears
        - Verify attestation ID displayed
        - Verify all 3 claims shown as badges
      </steps>
    </feature>

    <feature id="24">
      <name>Complete disclosure creation flow</name>
      <description>Test end-to-end disclosure creation</description>
      <steps>
        - Complete attestation flow first
        - Download secret file
        - Navigate to /disclose
        - Upload secret file
        - Verify "Secret loaded" message
        - Select 2 of 3 fields
        - Set expiry to 14 days
        - Set max accesses to 5
        - Click Create Disclosure Link
        - Sign message
        - Verify success with URL displayed
      </steps>
    </feature>

    <feature id="25">
      <name>Complete verification flow</name>
      <description>Test end-to-end verification by auditor</description>
      <steps>
        - Create disclosure, copy URL
        - Open URL in incognito (no wallet)
        - Verify page loads with green verified badge
        - Verify only selected fields are shown
        - Verify access count shows "View #1"
        - Verify expiration date shown
      </steps>
    </feature>

    <feature id="26">
      <name>Download secret file works</name>
      <description>Verify secret file downloads with correct content</description>
      <steps>
        - Generate attestation
        - Click "Download Secret File" button
        - Verify file downloaded as veilpass-secret-[id].json
        - Open file, verify valid JSON
        - Verify contains attestationId, salt, fullClaims
      </steps>
    </feature>

    <feature id="27">
      <name>Upload secret file parses correctly</name>
      <description>Verify secret file is parsed and displayed</description>
      <steps>
        - Navigate to /disclose
        - Select previously downloaded secret file
        - Verify "Secret loaded for attestation [id]..." message
        - Verify field selector shows correct claim types
        - Verify all claims from secret are available
      </steps>
    </feature>

    <feature id="28">
      <name>Copy disclosure link to clipboard</name>
      <description>Verify copy button copies URL to clipboard</description>
      <steps>
        - Create disclosure successfully
        - Click Copy button
        - Verify button text changes to "Copied!"
        - Paste somewhere to verify URL copied
      </steps>
    </feature>

    <feature id="29">
      <name>Create another attestation flow</name>
      <description>Verify "Create Another" button resets form</description>
      <steps>
        - Complete attestation generation
        - Click "Create Another" button
        - Verify form resets to initial state
        - Verify claim selector cleared
        - Verify can generate new attestation
      </steps>
    </feature>

    <feature id="30">
      <name>Create another disclosure flow</name>
      <description>Verify create another resets disclosure form</description>
      <steps>
        - Complete disclosure creation
        - Click "Create Another Disclosure"
        - Verify form resets
        - Verify file upload cleared
        - Verify field selector hidden
      </steps>
    </feature>

    <feature id="31">
      <name>Mint token demo flow</name>
      <description>Verify mint page demo creates fake token address</description>
      <steps>
        - Connect wallet
        - Navigate to /mint
        - Fill in: name "Test Token", symbol "TEST", supply 1000
        - Click Create Token
        - Verify "Creating Token..." loading state
        - Verify success card with fake address (RWA...)
      </steps>
    </feature>

    <feature id="32">
      <name>Dashboard quick actions work</name>
      <description>Verify dashboard buttons navigate correctly</description>
      <steps>
        - Connect wallet
        - Navigate to /dashboard
        - Click "Mint New Token" - verify navigates to /mint
        - Go back to dashboard
        - Click "Generate Attestation" - verify /attest
        - Go back
        - Click "Create Disclosure" - verify /disclose
      </steps>
    </feature>
  </workflow_completeness>

  <!-- E. Error Handling (6 features) -->
  <error_handling>
    <feature id="33">
      <name>API returns proper error for missing fields</name>
      <description>Verify 400 response for incomplete request bodies</description>
      <steps>
        - POST to /api/attestations/generate with empty body
        - Verify 400 status with validation error message
        - POST with holder but no claims
        - Verify specific error about claims
      </steps>
    </feature>

    <feature id="34">
      <name>API returns proper error for invalid attestation</name>
      <description>Verify disclosure API rejects invalid attestation/secret combo</description>
      <steps>
        - POST to /api/disclosures/create with wrong salt
        - Verify "Invalid attestation or secret" error
        - POST with non-existent attestationId
        - Verify "Attestation not found" error
      </steps>
    </feature>

    <feature id="35">
      <name>UI shows error when wallet not connected</name>
      <description>Verify error message if trying to submit without wallet</description>
      <steps>
        - Somehow trigger submit without wallet (e.g., disconnect mid-flow)
        - Verify "Please connect your wallet first" error displayed
      </steps>
    </feature>

    <feature id="36">
      <name>UI shows error for invalid secret file</name>
      <description>Verify error when uploading malformed JSON</description>
      <steps>
        - Navigate to /disclose
        - Upload a text file with invalid JSON
        - Verify "Invalid secret file format" error displayed
        - Upload empty file
        - Verify appropriate error
      </steps>
    </feature>

    <feature id="37">
      <name>Verification page shows expired error</name>
      <description>Verify expired disclosure shows clear error</description>
      <steps>
        - Create disclosure with 1 day expiry (or mock expired)
        - Wait for expiry or mock
        - Visit verify page
        - Verify red error card: "This disclosure has expired"
      </steps>
    </feature>

    <feature id="38">
      <name>Verification page shows access limit error</name>
      <description>Verify access limit shows clear error</description>
      <steps>
        - Create disclosure with maxAccesses: 1
        - Visit verify page once (success)
        - Visit again
        - Verify error: "Maximum access limit (1) reached"
      </steps>
    </feature>
  </error_handling>

  <!-- F. UI-Backend Integration (8 features) -->
  <ui_backend_integration>
    <feature id="39">
      <name>Attestation form submits to correct API</name>
      <description>Verify form POST goes to /api/attestations/generate</description>
      <steps>
        - Open network tab
        - Submit attestation form
        - Verify POST to /api/attestations/generate
        - Verify request body contains holder, claims, signature
      </steps>
    </feature>

    <feature id="40">
      <name>Disclosure form submits to correct API</name>
      <description>Verify form POST goes to /api/disclosures/create</description>
      <steps>
        - Open network tab
        - Submit disclosure form
        - Verify POST to /api/disclosures/create
        - Verify body contains attestationId, salt, fullClaims, fieldsToDisclose
      </steps>
    </feature>

    <feature id="41">
      <name>Verify page fetches from correct API</name>
      <description>Verify GET request to /api/disclosures/[id]</description>
      <steps>
        - Open network tab
        - Navigate to /verify/abc123
        - Verify GET to /api/disclosures/abc123
      </steps>
    </feature>

    <feature id="42">
      <name>Loading states during API calls</name>
      <description>Verify loading indicators show during requests</description>
      <steps>
        - Click Generate Attestation
        - Verify button shows "Generating..."
        - Verify button is disabled during loading
        - Same for disclosure: "Creating..."
      </steps>
    </feature>

    <feature id="43">
      <name>Success states after API completion</name>
      <description>Verify success UI replaces form after completion</description>
      <steps>
        - Complete attestation
        - Verify form hidden
        - Verify success card with checkmark visible
        - Verify attestation details shown
      </steps>
    </feature>

    <feature id="44">
      <name>Error states on API failure</name>
      <description>Verify error message displayed when API returns error</description>
      <steps>
        - Trigger API error (e.g., invalid data)
        - Verify red error text appears below form
        - Verify form stays visible for retry
      </steps>
    </feature>

    <feature id="45">
      <name>Form validation before submission</name>
      <description>Verify client-side validation prevents empty submissions</description>
      <steps>
        - On /attest with no claims selected
        - Click Generate Attestation
        - Verify "Please select at least one claim" error
        - Button should not trigger API call
      </steps>
    </feature>

    <feature id="46">
      <name>API response properly typed</name>
      <description>Verify API responses match TypeScript ApiResponse type</description>
      <steps>
        - Check all API responses have { success: boolean, data?: T, error?: string }
        - Verify attestation/generate returns data.attestation and data.secret
        - Verify disclosures/create returns data.disclosureId and data.verifyUrl
      </steps>
    </feature>
  </ui_backend_integration>

  <!-- G. State and Persistence (5 features) -->
  <state_persistence>
    <feature id="47">
      <name>Wallet connection persists across pages</name>
      <description>Verify wallet stays connected when navigating</description>
      <steps>
        - Connect wallet on landing page
        - Navigate to /attest - wallet still connected
        - Navigate to /disclose - wallet still connected
        - Navigate to /dashboard - wallet info shown
      </steps>
    </feature>

    <feature id="48">
      <name>Local KV mock stores data in memory</name>
      <description>Verify local mock persists during session</description>
      <steps>
        - Run without Vercel KV configured
        - Generate attestation
        - Create disclosure for same attestation
        - Verify page - works (data persisted in memory)
        - Note: Data clears on server restart
      </steps>
    </feature>

    <feature id="49">
      <name>Vercel KV integration when configured</name>
      <description>Verify real KV used when env vars set</description>
      <steps>
        - Configure KV_REST_API_URL and KV_REST_API_TOKEN
        - Generate attestation
        - Restart server
        - Verify attestation still accessible (persisted to Redis)
      </steps>
    </feature>

    <feature id="50">
      <name>Attestation result state managed correctly</name>
      <description>Verify attestation success state in component</description>
      <steps>
        - Generate attestation
        - Verify result state contains attestation and secret
        - Click Create Another
        - Verify result state cleared
      </steps>
    </feature>

    <feature id="51">
      <name>Disclosure result state managed correctly</name>
      <description>Verify disclosure success state in component</description>
      <steps>
        - Create disclosure
        - Verify result state contains disclosureId and verifyUrl
        - Click Create Another
        - Verify result state cleared, form reset
      </steps>
    </feature>
  </state_persistence>

  <!-- H. URL and Direct Access (4 features) -->
  <url_direct_access>
    <feature id="52">
      <name>Verify page accessible via direct URL</name>
      <description>Verify /verify/[id] works when accessed directly</description>
      <steps>
        - Create disclosure, get ID
        - Open new browser window
        - Navigate directly to /verify/[id]
        - Verify page loads and fetches data
      </steps>
    </feature>

    <feature id="53">
      <name>Dynamic route params extracted correctly</name>
      <description>Verify [id] param extracted from URL</description>
      <steps>
        - Navigate to /verify/test123abc
        - Check that API call uses "test123abc" as ID
        - Navigate to /verify/another-id
        - Check correct ID used
      </steps>
    </feature>

    <feature id="54">
      <name>Disclosure ID passed to API correctly</name>
      <description>Verify full ID passed without truncation</description>
      <steps>
        - Create disclosure, note full 12-char ID
        - Visit verify page
        - Verify API call uses full ID
        - Verify response matches that disclosure
      </steps>
    </feature>

    <feature id="55">
      <name>App URL configured for disclosure links</name>
      <description>Verify NEXT_PUBLIC_APP_URL used in formatDisclosureUrl</description>
      <steps>
        - Set NEXT_PUBLIC_APP_URL=http://localhost:3000
        - Create disclosure
        - Verify URL is http://localhost:3000/verify/[id]
        - Change to custom domain
        - Verify URLs use new domain
      </steps>
    </feature>
  </url_direct_access>

  <!-- I. Double-Action and Idempotency (3 features) -->
  <double_action_idempotency>
    <feature id="56">
      <name>Multiple attestation generations create unique IDs</name>
      <description>Verify each attestation gets unique ID</description>
      <steps>
        - Generate attestation, note ID
        - Generate another attestation
        - Verify different ID
        - Generate third
        - All three IDs unique
      </steps>
    </feature>

    <feature id="57">
      <name>Multiple disclosure creations create unique IDs</name>
      <description>Verify each disclosure gets unique ID</description>
      <steps>
        - Create disclosure, note ID
        - Create another from same attestation
        - Verify different ID
        - Both disclosures independently accessible
      </steps>
    </feature>

    <feature id="58">
      <name>Access count only increments once per request</name>
      <description>Verify single request increments by exactly 1</description>
      <steps>
        - Create disclosure
        - Check initial accessCount: 0
        - Visit verify page
        - Check accessCount: 1
        - Visit again
        - Check accessCount: 2
        - No double increments
      </steps>
    </feature>
  </double_action_idempotency>

  <!-- J. Data Cleanup and Cascade (3 features) -->
  <data_cleanup_cascade>
    <feature id="59">
      <name>Expired attestations handled gracefully</name>
      <description>Verify expired attestations don't crash system</description>
      <steps>
        - Attestation with past expiresAt
        - Try to create disclosure
        - Verify proper error, no crash
        - System continues working
      </steps>
    </feature>

    <feature id="60">
      <name>Expired disclosures handled gracefully</name>
      <description>Verify expired disclosures show clear error</description>
      <steps>
        - Disclosure with past expiresAt
        - Visit verify page
        - Verify "expired" error shown
        - No server errors
      </steps>
    </feature>

    <feature id="61">
      <name>TTL set correctly on KV entries</name>
      <description>Verify KV entries have appropriate TTL</description>
      <steps>
        - Generate attestation (1 year expiry)
        - Verify TTL set on KV key
        - Create disclosure (7 day default)
        - Verify shorter TTL
        - Data auto-expires from KV
      </steps>
    </feature>
  </data_cleanup_cascade>

  <!-- K. Default and Reset (3 features) -->
  <default_reset>
    <feature id="62">
      <name>Form fields have sensible defaults</name>
      <description>Verify default values on forms</description>
      <steps>
        - Navigate to /disclose
        - Verify expiresInDays default is 7
        - Verify maxAccesses default is 10
        - Navigate to /mint
        - Verify totalSupply default is 1000
      </steps>
    </feature>

    <feature id="63">
      <name>Create another resets form state</name>
      <description>Verify all form state cleared on reset</description>
      <steps>
        - Complete attestation with 3 claims
        - Click Create Another
        - Verify no claims selected
        - Verify no error messages
        - Verify loading state false
      </steps>
    </feature>

    <feature id="64">
      <name>Expires in days defaults to 7</name>
      <description>Verify disclosure expiry default</description>
      <steps>
        - Create disclosure without changing expiry
        - Check disclosure.expiresAt
        - Verify it's ~7 days from now
      </steps>
    </feature>
  </default_reset>

  <!-- L. Search and Filter Edge Cases (2 features) -->
  <search_filter_edge_cases>
    <feature id="65">
      <name>Claim selector handles all claim types</name>
      <description>Verify all 5 claim types selectable</description>
      <steps>
        - Navigate to /attest
        - Verify 5 checkboxes: KYC_VERIFIED, AML_PASSED, ACCREDITED_INVESTOR, JURISDICTION_COMPLIANT, SOURCE_OF_FUNDS_VERIFIED
        - Select each one
        - Verify all 5 included in submission
      </steps>
    </feature>

    <feature id="66">
      <name>Field selector shows only available fields</name>
      <description>Verify field selector matches secret file claims</description>
      <steps>
        - Generate attestation with only 2 claims
        - Download secret
        - Upload to disclosure page
        - Verify only those 2 claims shown as options
        - Cannot select non-existent claims
      </steps>
    </feature>
  </search_filter_edge_cases>

  <!-- M. Form Validation (5 features) -->
  <form_validation>
    <feature id="67">
      <name>At least one claim required for attestation</name>
      <description>Verify can't submit empty claim selection</description>
      <steps>
        - Connect wallet on /attest
        - Don't select any claims
        - Click Generate
        - Verify "Please select at least one claim" error
        - Button disabled when no claims
      </steps>
    </feature>

    <feature id="68">
      <name>At least one field required for disclosure</name>
      <description>Verify can't create disclosure with no fields</description>
      <steps>
        - Upload secret file on /disclose
        - Don't select any fields
        - Try to submit
        - Verify validation error
        - Button disabled when no fields selected
      </steps>
    </feature>

    <feature id="69">
      <name>Token name required for mint</name>
      <description>Verify mint form validates required fields</description>
      <steps>
        - Navigate to /mint
        - Leave name empty
        - Try to submit
        - Verify HTML5 required validation
      </steps>
    </feature>

    <feature id="70">
      <name>Token symbol validated</name>
      <description>Verify symbol uppercase and max length</description>
      <steps>
        - Enter lowercase symbol "test"
        - Verify converted to "TEST"
        - Enter very long symbol
        - Verify truncated to max length (10)
      </steps>
    </feature>

    <feature id="71">
      <name>Expires in days validated (1-30)</name>
      <description>Verify expiry within allowed range</description>
      <steps>
        - Try to set expiresInDays to 0
        - Verify input doesn't accept or shows error
        - Try to set to 31
        - Verify capped or error
        - Set to 15 - accepted
      </steps>
    </feature>
  </form_validation>

  <!-- N. Feedback and Notification (4 features) -->
  <feedback_notification>
    <feature id="72">
      <name>Success message after attestation</name>
      <description>Verify clear success feedback after generation</description>
      <steps>
        - Generate attestation
        - Verify green checkmark icon
        - Verify "Attestation Generated" title
        - Verify ID and claims displayed
      </steps>
    </feature>

    <feature id="73">
      <name>Success message after disclosure</name>
      <description>Verify clear success feedback after disclosure</description>
      <steps>
        - Create disclosure
        - Verify green checkmark icon
        - Verify "Disclosure Created" title
        - Verify shareable URL displayed
      </steps>
    </feature>

    <feature id="74">
      <name>Copy confirmation feedback</name>
      <description>Verify visual feedback when copying link</description>
      <steps>
        - Create disclosure
        - Click Copy button
        - Verify button text changes to "Copied!"
        - After 2 seconds, reverts to "Copy"
      </steps>
    </feature>

    <feature id="75">
      <name>Warning about saving secret file</name>
      <description>Verify prominent warning about secret file</description>
      <steps>
        - Generate attestation
        - Verify amber/warning colored card
        - Verify warning icon
        - Verify text mentions "cannot be recovered if lost"
        - Verify download button prominent
      </steps>
    </feature>
  </feedback_notification>

  <!-- O. Responsive and Layout (4 features) -->
  <responsive_layout>
    <feature id="76">
      <name>Header responsive on mobile</name>
      <description>Verify header works on mobile viewport</description>
      <steps>
        - Set viewport to 375px width
        - Verify logo visible
        - Verify wallet button visible
        - Verify layout doesn't break
      </steps>
    </feature>

    <feature id="77">
      <name>Navigation hidden on mobile</name>
      <description>Verify nav links hidden on small screens</description>
      <steps>
        - Set viewport to mobile
        - Verify nav links hidden (hidden md:flex)
        - On desktop, nav links visible
      </steps>
    </feature>

    <feature id="78">
      <name>Forms stack properly on mobile</name>
      <description>Verify form elements stack vertically on mobile</description>
      <steps>
        - View /disclose on mobile
        - Verify expiry and max access inputs stack (grid-cols-2 becomes 1)
        - Verify buttons full width
        - No horizontal overflow
      </steps>
    </feature>

    <feature id="79">
      <name>Cards responsive across breakpoints</name>
      <description>Verify card grid adapts to screen size</description>
      <steps>
        - View landing page feature cards
        - Desktop: 4 columns (lg:grid-cols-4)
        - Tablet: 2 columns (md:grid-cols-2)
        - Mobile: 1 column
      </steps>
    </feature>
  </responsive_layout>

  <!-- P. Accessibility (3 features) -->
  <accessibility>
    <feature id="80">
      <name>All interactive elements keyboard accessible</name>
      <description>Verify Tab navigation works throughout</description>
      <steps>
        - Start at page top
        - Tab through all interactive elements
        - Verify focus visible on each
        - Verify can activate buttons with Enter
        - Verify can toggle checkboxes with Space
      </steps>
    </feature>

    <feature id="81">
      <name>Form labels associated with inputs</name>
      <description>Verify labels have htmlFor matching input id</description>
      <steps>
        - Check ClaimSelector labels link to checkboxes
        - Check Input components have associated labels
        - Click label, verify input focused
      </steps>
    </feature>

    <feature id="82">
      <name>Color contrast meets WCAG AA</name>
      <description>Verify sufficient contrast ratios</description>
      <steps>
        - Text Primary (#FAFAFA) on Background (#0A0A0B) - verify 4.5:1+
        - Text Muted (#A1A1AA) on Surface (#18181B) - verify readable
        - Accent (#10B981) text readable
        - Error states readable
      </steps>
    </feature>
  </accessibility>

  <!-- Q. Temporal and Timezone (2 features) -->
  <temporal_timezone>
    <feature id="83">
      <name>Dates display in user locale</name>
      <description>Verify dates formatted appropriately</description>
      <steps>
        - Create disclosure
        - View verify page
        - Check issuedAt date format (toLocaleDateString)
        - Check expiration date format
        - Verify readable, localized format
      </steps>
    </feature>

    <feature id="84">
      <name>Expiration calculated correctly</name>
      <description>Verify expiresAt math is correct</description>
      <steps>
        - Create disclosure with 7 day expiry
        - Check expiresAt timestamp
        - Verify it's exactly now + 7 days in milliseconds
        - Account for timezone correctly
      </steps>
    </feature>
  </temporal_timezone>

  <!-- R. Concurrency and Race Conditions (1 feature) -->
  <concurrency_race_conditions>
    <feature id="85">
      <name>Rapid form submissions handled</name>
      <description>Verify double-click doesn't cause issues</description>
      <steps>
        - Click Generate Attestation rapidly
        - Verify button disabled during loading
        - Verify only one attestation created
        - No duplicate submissions
      </steps>
    </feature>
  </concurrency_race_conditions>
</core_features>

<reference_code>
  IMPORTANT: The full VeilPass specification with exact code for every file is saved at:
  /Users/mujeeb/veilpass/VEILPASS_SPEC_ORIGINAL.md

  Refer to this file for:
  - Exact TypeScript type definitions (src/types/index.ts)
  - Exact library implementations (src/lib/*.ts)
  - Exact component code (src/components/**/*.tsx)
  - Exact page implementations (src/app/**/page.tsx)
  - Exact API route code (src/app/api/**/route.ts)
  - Tailwind and CSS configuration
  - Environment variable setup

  The agent MUST read this file before implementing any feature to ensure
  the code matches the specification exactly.
</reference_code>

</project_specification>
